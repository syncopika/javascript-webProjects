<!DOCTYPE html>

<html>

<head>
<title>experiment</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
</head>

<style>
canvas{
display: block;
margin:0 auto;
margin-top: 2%;
}
h1{
text-align:center;
}
#console{
text-align:center;
margin:0 auto;
width: 30%;
height: auto;
border: 2px black solid;
margin-bottom: 10%;
}
p{
text-align: center;
}
</style>

<body>
<h1>canvas experiment</h1>
<p>space bar to click, arrow keys to move. :) </p>
<div id='theCanvas'>
<canvas id='canvas' height='600' width='600' style='border: 1px black solid'></canvas>
<h2 id='log' style='text-align:center'></h2>
</div>
<div id='console'><h3>where am I?</h3>
<p id='xCoord'></p>
<p id='yCoord'></p>
<p id='objColor'></p>
</div>

<script>
//log current coordinates
function logCoordinates(){
var xCoord = document.getElementById('xCoord');
var yCoord = document.getElementById('yCoord');
var objColor = document.getElementById('objColor');
xCoord.textContent = "X coordinate: " + x;
yCoord.textContent = "Y coordinate: " + y;
objColor.textContent = "object color is " + objectColor;
}

var context = document.getElementById('canvas').getContext("2d");

function left(){
objectPresent = false;
context.clearRect(x,y,w,z);
x-=2;
context.fillRect(x,y,w,z);
}

function right(){
objectPresent = false;
context.clearRect(x,y,w,z);
x+=2;
context.fillRect(x,y,w,z);
}

function up(){
objectPresent = false;
context.clearRect(x,y,w,z);
y-=2;
context.fillRect(x,y,w,z);
}

function down(){
objectPresent = false;
context.clearRect(x,y,w,z);
y+=2;
context.fillRect(x,y,w,z);
}


var objectPresent = false;
var objectColor;

function checkRight(){
var obstacleColorData = context.getImageData(x+22, y, 1, 20).data;
var obstacleColor = 'rgb(' + obstacleColorData[0] + ',' + obstacleColorData[1] + ',' + obstacleColorData[2] + ')';
var check = true;
for(i=0;i<obstacleColorData.length;i+=4){
    //if we find a pixel that's not white or black
	if(obstacleColorData[i] !== 255 && obstacleColorData[i] !== 0){
	check = false;
	objectPresent = true;
	objectColor = obstacleColorData[i];
	}
}
if(x+22 === 600){
check = false;
}
return check;
}

function checkLeft(){
var obstacleColorData = context.getImageData(x-2, y, 1, 20).data;
var obstacleColor = 'rgb(' + obstacleColorData[0] + ',' + obstacleColorData[1] + ',' + obstacleColorData[2] + ')';
var check = true;
for(i=0;i<obstacleColorData.length;i+=4){
	if(obstacleColorData[i] !== 255 && obstacleColorData[i] !== 0){
	check = false;
	objectPresent = true;
	objectColor = obstacleColorData[i];
	}
}
if(x-2 === 0){
check = false;
}
return check;
}

function checkUp(){
var obstacleColorData = context.getImageData(x, y-2, 20, 1).data;
var obstacleColor = 'rgb(' + obstacleColorData[0] + ',' + obstacleColorData[1] + ',' + obstacleColorData[2] + ')';
var check = true;
for(i=0;i<obstacleColorData.length;i+=4){
	if(obstacleColorData[i] !== 255 && obstacleColorData[i] !== 0){
	check = false;
	objectPresent = true;
	objectColor = obstacleColorData[i];
	}
}
if(y-2 === 0){
check = false;
}
return check;
}

function checkDown(){
var obstacleColorData = context.getImageData(x, y+22, 20, 1).data;
var obstacleColor = 'rgb(' + obstacleColorData[0] + ',' + obstacleColorData[1] + ',' + obstacleColorData[2] + ')';
var check = true;
for(i=0;i<obstacleColorData.length;i+=4){
	if(obstacleColorData[i] !== 255 && obstacleColorData[i] !== 0){
	check = false;
	objectPresent = true;
	objectColor = obstacleColorData[i];
	}
}
if(y+22 === 600){
check = false;
}
return check;
}


function cleanCanvas(){
//paint background of canvas
context.rect(0,0,600,600);
context.fillStyle = 'rgb(255,255,255)';
context.fill();
}

//draw an obstacle
function drawObstacle(){
context.strokeRect(100,100,100,100);
}

function drawObstacle2(){
var imgData = context.getImageData(350, 350, 100, 200);
var someObstacle = imgData.data;
for(i=0;i<someObstacle.length;i+=4){
 someObstacle[i] = 120;
 someObstacle[i+1] = 120;
 someObstacle[i+2] = 120;
}
context.putImageData(imgData, 350, 350);
//return imgData;
}

var object = function(){
x = 20;  
y = 20;
w = 20;  //width
z = 20; //height
context.fillStyle='rgb(120,255,70)';
context.fillRect(x,y,w,z);


$(document).keydown(function(e){
switch(e.which){
    case 37: //left arrow key
	if(checkLeft()){
	left();
	logCoordinates();
	}
	break;
	case 39: //right arrow key
	if(checkRight()){
	right();
	logCoordinates();
	}
	break;
	case 40: //down
	if(checkDown()){
	down();
	logCoordinates();
	}
	break;
	case 38: //up
	if(checkUp()){
	up();
	logCoordinates();
	}
	break;
	case 32: //spacebar
	if(objectPresent){
	var log = document.getElementById('log');     
		if(objectColor === 120){
		log.textContent = "Brian's house.";
		}
		else if(122 <= objectColor && objectColor <= 127){
		log.textContent = "Nick's house.";
		}
		else{
		log.textContent = "hey, you clicked on me!!!";
		}
	}
	break;
	default:
	return;
	}
	e.preventDefault();
});

/*
this.onclick = function(){
context.clearRect(x,y,w,z);
//change only the coordinates on the canvas!!
//w and z are for width and height, respectively
x++;
y++;
context.fillRect(x,y,w,z);
}
*/
}

function drawPath(){
//draw a path
context.beginPath();
context.moveTo(200,200);
context.lineTo(300,450);
context.strokeStyle = 'black';
context.lineWidth = 5;
context.stroke(); 
}

$(document).ready(function(){
cleanCanvas();
object();
logCoordinates();
drawObstacle();
drawObstacle2();
drawPath();
});
</script>


</body>

</html>
